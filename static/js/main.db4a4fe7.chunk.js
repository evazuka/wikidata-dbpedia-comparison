(this["webpackJsonpfamily-tree"]=this["webpackJsonpfamily-tree"]||[]).push([[0],{104:function(e,t,n){e.exports=n(118)},110:function(e,t,n){},112:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var a,r=n(44),i=n.n(r),o=n(0),u=n.n(o),s=n(45),l=n(14),c=n(2),d=n.n(c),p=n(8),h=n(3),b=n(7),v=n(20),m=n(13),f=n(12),y=(n(110),function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).state={value:"",error:null},a.handleChange=a.handleChange.bind(Object(v.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(v.a)(a)),a}return Object(b.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value,error:null})}},{key:"handleSubmit",value:function(){var e=Object(p.a)(d.a.mark((function e(t){var n,a,r,i,o,u,s,l,c,p,h,b;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(u=null===(n=this.state.value.split("wiki/"))||void 0===n||null===(a=n[1])||void 0===a||null===(r=a.split("?"))||void 0===r||null===(i=r[0])||void 0===i||null===(o=i.split("/"))||void 0===o?void 0:o[0])){e.next=3;break}return e.abrupt("return",this.setState({error:"Wrong URL entered! Try https://en.wikipedia.org/wiki/Elizabeth_II"}));case 3:return s=decodeURI(u),"https://en.wikipedia.org/w/api.php?origin=*&format=json&action=query&prop=pageprops&ppprop=wikibase_item&redirects=1&titles=",e.prev=5,e.next=8,fetch("https://en.wikipedia.org/w/api.php?origin=*&format=json&action=query&prop=pageprops&ppprop=wikibase_item&redirects=1&titles="+s);case 8:return l=e.sent,e.next=11,l.json();case 11:if(c=e.sent,p=c.query.pages,"-1"!==(h=Object.keys(p)[0])){e.next=16;break}return e.abrupt("return",this.setState({error:"There's no data about this item in knowledge bases"}));case 16:b=p[h].pageprops.wikibase_item,this.props.history.push("/tree-comparison/".concat(b,"/").concat(s)),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(5),e.abrupt("return",this.setState({error:"Error happend while retrieval of this item"}));case 23:case"end":return e.stop()}}),e,this,[[5,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return u.a.createElement("div",{className:"container"},u.a.createElement("h2",null,"The comparison of Wikidata and DBpedia knowledge bases")," ",u.a.createElement("br",null),u.a.createElement("p",null,"Enter the link to the person's page on Wikipedia to build a family tree of his descendants")," ",u.a.createElement("br",null),u.a.createElement("div",null,u.a.createElement("input",{type:"text",value:this.state.value,onChange:this.handleChange,style:{width:"500px"}}),u.a.createElement("button",{onClick:this.handleSubmit},"View")),void 0!==this.state.error?u.a.createElement("p",{className:"error"},this.state.error):null)}}]),n}(u.a.Component)),E=n(22),w=(n(111),n(112),n(10)),O=n(18),g=function(){function e(t){Object(h.a)(this,e),this.endpoint=void 0,this.endpoint=t}return Object(b.a)(e,[{key:"query",value:function(e){var t=this.endpoint+"?query="+encodeURIComponent(e)+"&format=json";return fetch(t,{headers:{Accept:"application/sparql-results+json"}}).then((function(e){return e.json()}))}}]),e}(),k=function(e){return e.map((function(e){return{id:e.person.value,name:e.personLabel.value,birth:e.birth.value,death:e.death.value,picture:e.pic.value,parent:""}}))},I=function e(){var t=this;Object(h.a)(this,e),this.endpointUrl="https://query.wikidata.org/sparql",this.rootSparqlQuery=function(e){return"SELECT DISTINCT ?person ?personLabel ?birth ?death ?pic WHERE {\n        BIND (wd:".concat(e,' as ?person) .\n        OPTIONAL {?person wdt:P18 ?picture . }\n        OPTIONAL {?person wdt:P569 ?dob . }\n        OPTIONAL {?person wdt:P570 ?dod . }\n        BIND(YEAR(?dob) as ?yob) .\n        BIND(YEAR(?dod) as ?yod) .\n        BIND(COALESCE(?picture, "") as ?pic) .\n        BIND(COALESCE(?yob, "") as ?birth) .\n        BIND(COALESCE(?yod, "") as ?death) .\n              SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }\n        } LIMIT 1')},this.sparqlQuery=function(e){return"SELECT ?descendant ?descendantLabel (SAMPLE(?person) AS ?personId) (SAMPLE(?birth) AS ?birthYear) (SAMPLE(?death) AS ?deathYear) (SAMPLE(?pic) AS ?image) WHERE {\n        wd:".concat(e,' wdt:P40* ?person .\n        ?person wdt:P40 ?descendant .\n        OPTIONAL { ?descendant wdt:P18 ?picture . }\n        OPTIONAL {?descendant wdt:P569 ?dob . }\n        OPTIONAL {?descendant wdt:P570 ?dod . }\n        BIND(YEAR(?dob) as ?yob) .\n        BIND(YEAR(?dod) as ?yod) .\n        BIND(COALESCE(?picture, "") as ?pic) .\n        BIND(COALESCE(?yob, "") as ?birth) .\n        BIND(COALESCE(?yod, "") as ?death) .\n              SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en". }\n        } GROUP BY ?descendant ?descendantLabel')},this.queryDispatcher=new g(this.endpointUrl),this.query=function(){var e=Object(p.a)(d.a.mark((function e(n){var a,r,i,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.queryDispatcher.query(t.sparqlQuery(n));case 2:return a=e.sent,e.next=5,t.queryDispatcher.query(t.rootSparqlQuery(n));case 5:return r=e.sent,u=a.results.bindings,i=u.map((function(e){return{id:e.descendant.value,name:e.descendantLabel.value,birth:e.birthYear.value,death:e.deathYear.value,picture:e.image.value,parent:e.personId.value}})),o=k(r.results.bindings),e.abrupt("return",[].concat(Object(O.a)(i),Object(O.a)(o)));case 9:case"end":return e.stop()}var u}),e)})));return function(t){return e.apply(this,arguments)}}()},T=n(48),D=n(17),A=function(e){var t=D.d().id((function(e){return e.id})).parentId((function(e){return e.parent}))(e),n=800/(t.height+1);return[D.e().nodeSize([50,150])(t),10,n]},S=function(e){var t="";return""!==e.data.birth&&(t+="b. ".concat(e.data.birth)),""!==e.data.death&&(e.data.birth&&(t+=" - "),t+="d. ".concat(e.data.death)),t},x=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).ref=void 0,e.renderD3=function(){var t=A(e.props.data),n=Object(T.a)(t,3),a=n[0],r=n[1],i=n[2],o=1/0,u=-o;a.each((function(e){e.x>u&&(u=e.x),e.x<o&&(o=e.x)}));var s=Math.random(),l=D.c(e.ref),c=l.append("g").attr("font-family","sans-serif").attr("font-size",10).attr("transform","translate(".concat(i/3,",").concat(r-o,")")),d=(c.append("g").attr("fill","none").attr("stroke","#555").attr("stroke-opacity",.4).attr("stroke-width",1.5).selectAll("path").data(a.links()).join("path").attr("d",D.b().x((function(e){return e.y})).y((function(e){return e.x}))),c.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).selectAll("g").data(a.descendants()).join("g").attr("transform",(function(e){return"translate(".concat(e.y,",").concat(e.x,")")})));l.append("defs").append("clipPath").attr("id","circleClip"+s).append("circle").attr("r",20),d.append("circle").attr("r",20).attr("fill","grey"),d.append("svg:image").attr("xlink:href",(function(e){return e.data.picture})).attr("clip-path","url(#circleClip"+s+")").attr("x",-20).attr("y",-20).attr("height",40).attr("width",40).attr("preserveAspectRatio","xMidYMid slice"),d.append("text").attr("dy","0.31em").attr("x",(function(e){return e.children?-22:22})).attr("text-anchor",(function(e){return e.children?"end":"start"})).text((function(e){return e.data.name})).clone(!0).lower().attr("stroke","white"),d.append("text").attr("dy","1.3em").attr("x",(function(e){return e.children?-22:22})).attr("text-anchor",(function(e){return e.children?"end":"start"})).text(S).clone(!0).lower().attr("stroke","white"),l.attr("viewBox",[0,0,800,u-o+2*r]).call(D.f().extent([[0,0],[800,u-o+2*r]]).scaleExtent([1,8]).on("zoom",(function(){c.attr("transform",D.a.transform)})))},e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"render",value:function(){var e=this;return u.a.createElement("svg",{className:"container",ref:function(t){return e.ref=t},width:800,height:window.innerHeight})}}]),n}(u.a.Component);!function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Finished=2]="Finished",e[e.Failed=3]="Failed"}(a||(a={}));var C=function(e){var t=e.overview;return u.a.createElement(u.a.Fragment,null,u.a.createElement("p",null,u.a.createElement("strong",null,"Status:")," ",a[t.status]),null!==t.time?u.a.createElement("p",null,u.a.createElement("strong",null,"Time:")," ",t.time," ms"):null,null!==t.nodeCount?u.a.createElement("p",null,u.a.createElement("strong",null,"Node count:")," ",t.nodeCount):null,null!==t.error?u.a.createElement("p",null,u.a.createElement("strong",null,"Error:")," ",t.error):null)},j=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){return Object(h.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){var e=this.props,t=e.wikidataQueryOverview,n=e.dbpediaQueryOverview;return u.a.createElement("div",null,u.a.createElement("h3",null,"Wikidata Query Overview"),u.a.createElement(C,{overview:t}),u.a.createElement("hr",null),u.a.createElement("h3",null,"DBpedia Query Overview"),u.a.createElement(C,{overview:n}))}}]),n}(u.a.Component),N=function(e){return e.map((function(e){return{id:e.person.value,name:e.label.value,birth:e.yob.value,death:e.yod.value,picture:e.pic.value,parent:""}}))},L=function e(){var t=this;Object(h.a)(this,e),this.endpointUrl="https://dbpedia.org/sparql",this.rootSparqlQuery=function(e){return"PREFIX dbo: <http://dbpedia.org/ontology/> \n    SELECT DISTINCT ?person ?pic ?label ?yob ?yod \n    WHERE {\n         BIND(<".concat(e,'> as ?person)\n         ?person rdfs:label ?label .\n         OPTIONAL { ?person  dbo:birthDate ?dob} \n         OPTIONAL { ?person  dbo:deathDate ?dod}\n         OPTIONAL { ?person dbo:thumbnail ?thumbnail} \n         BIND(IF(bound(?dob),\n         YEAR(xsd:dateTime(?dob)),\n         "") as ?yob)\n         BIND(IF(bound(?dod),\n         YEAR(xsd:dateTime(?dod)),\n         "") as ?yod)\n         BIND(COALESCE(?thumbnail, "") as ?pic) .\n              FILTER (lang(?label) = \'en\')\n    } LIMIT 1')},this.sparqlQuery=function(e){return"PREFIX dbo: <http://dbpedia.org/ontology/> \n    SELECT DISTINCT ?person ?pic ?label ?yob ?yod ?descendant\n    WHERE {\n         ?person dbo:parent* <".concat(e,'> \n         OPTIONAL { ?descendant dbo:parent ?person }\n         BIND(?person as ?person)\n         OPTIONAL { ?descendant rdfs:label ?label }\n         OPTIONAL { ?descendant  dbo:birthDate ?dob} \n         OPTIONAL { ?descendant  dbo:deathDate ?dod}\n         OPTIONAL { ?descendant dbo:thumbnail ?thumbnail} \n         BIND(IF(bound(?dob),\n         YEAR(xsd:dateTime(?dob)),\n         "") as ?yob)\n         BIND(IF(bound(?dod),\n         YEAR(xsd:dateTime(?dod)),\n         "") as ?yod)\n         BIND(COALESCE(?thumbnail, "") as ?pic) .\n              FILTER (lang(?label) = \'en\')\n    }')},this.queryDispatcher=new g(this.endpointUrl),this.query=function(){var e=Object(p.a)(d.a.mark((function e(n){var a,r,i,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.queryDispatcher.query(t.sparqlQuery(n));case 2:return a=e.sent,e.next=5,t.queryDispatcher.query(t.rootSparqlQuery(n));case 5:return r=e.sent,u=a.results.bindings,i=u.map((function(e){return{id:e.descendant.value,name:e.label.value,birth:e.yob.value,death:e.yod.value,picture:e.pic.value,parent:e.person.value}})),o=N(r.results.bindings),e.abrupt("return",[].concat(Object(O.a)(i),Object(O.a)(o)));case 9:case"end":return e.stop()}var u}),e)})));return function(t){return e.apply(this,arguments)}}()},P=function(e){Object(m.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(h.a)(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).wikidataTreeQuery=new I,e.dbpediaTreeQuery=new L,e.state={wikidataQueryOverview:{status:a.NotStarted,nodeCount:null,time:null,error:null},dbpediaQueryOverview:{status:a.NotStarted,nodeCount:null,time:null,error:null},dbpediaTreeData:null,wikidataTreeData:null},e.startComparison=Object(p.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.startWikidataQuery();case 2:return t.next=4,e.startDbPediaQuery();case 4:case"end":return t.stop()}}),t)}))),e.startDbPediaQuery=Object(p.a)(d.a.mark((function t(){var n,r,i,o,u;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState((function(e){return{dbpediaQueryOverview:Object(E.a)(Object(E.a)({},e.dbpediaQueryOverview),{},{status:a.Running})}})),n="http://dbpedia.org/resource/"+e.props.match.params.wikiId,t.prev=2,r=(new Date).getTime(),t.next=6,e.dbpediaTreeQuery.query(n);case 6:i=t.sent,o=(new Date).getTime(),u=o-r,console.log(i),e.setState({dbpediaQueryOverview:{status:a.Finished,time:u,nodeCount:i.length,error:null},dbpediaTreeData:i}),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),e.setState({dbpediaQueryOverview:{status:a.Failed,time:null,nodeCount:null,error:"Error happened while querying data"}});case 16:case"end":return t.stop()}}),t,null,[[2,13]])}))),e.startWikidataQuery=Object(p.a)(d.a.mark((function t(){var n,r,i,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState((function(e){return{wikidataQueryOverview:Object(E.a)(Object(E.a)({},e.wikidataQueryOverview),{},{status:a.Running})}})),t.prev=1,n=(new Date).getTime(),t.next=5,e.wikidataTreeQuery.query(e.props.match.params.wikidataId);case 5:r=t.sent,i=(new Date).getTime(),o=i-n,e.setState({wikidataQueryOverview:{status:a.Finished,time:o,nodeCount:r.length,error:null},wikidataTreeData:r}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),e.setState({wikidataQueryOverview:{status:a.Failed,time:null,nodeCount:null,error:"Error happened while querying data"}});case 14:case"end":return t.stop()}}),t,null,[[1,11]])}))),e}return Object(b.a)(n,[{key:"componentDidMount",value:function(){this.startComparison()}},{key:"render",value:function(){return u.a.createElement(w.d,{forceRenderTabPanel:!0},u.a.createElement(w.b,null,u.a.createElement(w.a,null,"Statistics"),u.a.createElement(w.a,null,"Wikidata Tree"),u.a.createElement(w.a,null,"DBpedia Tree")),u.a.createElement(w.c,null,u.a.createElement(j,{wikidataQueryOverview:this.state.wikidataQueryOverview,dbpediaQueryOverview:this.state.dbpediaQueryOverview})),u.a.createElement(w.c,null,null===this.state.wikidataTreeData?u.a.createElement(u.a.Fragment,null,"Loading..."):u.a.createElement(x,{data:this.state.wikidataTreeData})),u.a.createElement(w.c,null,null===this.state.dbpediaTreeData?u.a.createElement(u.a.Fragment,null,"Loading..."):u.a.createElement(x,{data:this.state.dbpediaTreeData})))}}]),n}(u.a.Component);function Q(){return u.a.createElement(s.a,null,u.a.createElement(u.a.Fragment,null,u.a.createElement(l.c,null,u.a.createElement(l.a,{path:"/tree-comparison/:wikidataId/:wikiId",render:function(e){return u.a.createElement(P,e)}}),u.a.createElement(l.a,{path:"/",render:function(e){return u.a.createElement(y,e)}}))))}i.a.render(u.a.createElement(Q,null),document.getElementById("root"))}},[[104,1,2]]]);
//# sourceMappingURL=main.db4a4fe7.chunk.js.map